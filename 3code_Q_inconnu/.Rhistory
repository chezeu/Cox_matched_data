#titlename =paste ("nA=", nA, "nB=", nB)
colnames(boxplot_beta0) = c("Estimator", varies, fixed,"beta0.1","beta0.2","beta0.3")
boxplot_beta0 = data.frame(boxplot_beta0)
boxplot_beta0[,1] = factor(boxplot_beta0[,1],
levels = 1:6, labels = c("Theorical"," Naive", "weighted average", "2-max weighted average", "Q_weighted average","EM"))
boxplot_beta0[,2] = as.factor(boxplot_beta0[,2] )
boxplot_beta0[,3] = as.factor(boxplot_beta0[,3] )
boxplot_beta0[,4] = as.numeric(boxplot_beta0[,4] )
boxplot_beta0[,5] = as.numeric(boxplot_beta0[,5] )
boxplot_beta0[,6] = as.numeric(boxplot_beta0[,6] )
# Boxplots for beta0
beta0_1_K = ggplot(boxplot_beta0,aes(x=K,y= beta0.1,fill=Estimator))+
geom_boxplot()+
xlab(varies)+
ylab(quote(hat(beta)[1]))+
geom_hline(yintercept=beta[1],lty=1,col="orange")
#beta0_1
beta0_2_K = ggplot(boxplot_beta0,aes(x=K,y= beta0.2,fill=Estimator))+
geom_boxplot()+
theme(legend.position = "none")+
xlab(varies)+
ylab(quote(hat(beta)[2]))+
geom_hline(yintercept=beta[2],lty=1,col="orange")
#beta0_2
beta0_3_K = ggplot(boxplot_beta0,aes(x=K,y= beta0.3,fill=Estimator))+
geom_boxplot()+
theme(legend.position = "none")+
xlab(varies)+
ylab(quote(hat(beta)[3]))+
geom_hline(yintercept=beta[3],lty=1,col="orange")
#beta0_3
#figure <- ggarrange(beta0_1, beta0_2, beta0_3,
#          common.legend = TRUE,
#                  ncol = 2, nrow = 2)
#figure
#data_histogram = boxplot_beta0[which(boxplot_beta0$Estimator==unique(boxplot_beta0$Estimator)[3]),]
#K_hist = unique(data_histogram$K)
#for (i in 1:length(K_hist)) {
# k= K_hist[i]
#  beta_hist =data_histogram[which(data_histogram$K==k),]
#  hist(beta_hist$beta0.1, xlab= quote(hat(beta)[1]),main = paste("nA =",unique( beta_hist$nA),",","K=",unique( beta_hist$K)))
# hist(beta_hist$beta0.2, xlab= quote(hat(beta)[2]),main = paste("nA =",unique( beta_hist$nA),",","K=",unique( beta_hist$K)))
#hist(beta_hist$beta0.3, xlab= quote(hat(beta)[3]),main = paste("nA =",unique( beta_hist$nA),",","K=",unique( beta_hist$K)))
#}
#########################################################
################### censor varied
setwd("C:/Users/fchezeut/Documents/GitHub/Cox-matched-data/3code_Q_inconnu")
#source("5_EM_scenarios.R")
source("7_EM_scenarios.R")
#scenarios_boxplot=scenarios[scenarios$K==9,]
scenarios_boxplot=scenarios[(scenarios$K==16)&
( scenarios$nB==2000),]
#scenarios_boxplot=scenarios[scenarios$K==27,]
varies = "censor"
fixed="nA"
library(ggplot2)
library(gridExtra)
library(xtable)
Censor_sample=c(30,40,20)# for 30%,40%,20%
boxplot_beta0 = NULL
# size fix
for (i in (1:nrow(scenarios_boxplot))){
nsim = scenarios_boxplot[i,1]
K = scenarios_boxplot[i,2]
nA = scenarios_boxplot[i,3]
nB= scenarios_boxplot[i,4]
censor=scenarios_boxplot[i,5]
load(paste0("C:/Users/fchezeut/Documents/GitHub/Cox-matched-data/3code_Q_inconnu/Results/",
"nsim=",nsim,"_nA=",nA,"_K=",K,"censor=",censor,".Rdata"))
results_sample = results_sample
boxplot_beta0_true = cbind(rep(1,times=nsim),
rep(Censor_sample[i],times=nsim),
rep(nA, times=nsim),
results_sample$coef_true_s1,
results_sample$coef_true_s2,
results_sample$coef_true_s3)
boxplot_beta0_naive = cbind(rep(2,times=nsim),
rep(Censor_sample[i],times=nsim),
rep(nA, times=nsim),
results_sample$coef_naive_s1,
results_sample$coef_naive_s2,
results_sample$coef_naive_s3)
boxplot_beta0_w_sum1 = cbind(rep(3,times=nsim),
rep(Censor_sample[i],times=nsim),
rep(nA,times=nsim),
results_sample$coef_w_sum1_s1,
results_sample$coef_w_sum1_s2,
results_sample$coef_w_sum1_s3)
boxplot_beta0_w_sum2 = cbind(rep(4,times=nsim),
rep(Censor_sample[i],times=nsim),
rep(nA,times=nsim),
results_sample$coef_w_sum2_s1,
results_sample$coef_w_sum2_s2,
results_sample$coef_w_sum2_s3)
boxplot_beta0_Q_sum = cbind(rep(5,times=nsim),
rep(Censor_sample[i],times=nsim),
rep(nA,times=nsim),
results_sample$coef_Q_sum_s1,
results_sample$coef_Q_sum_s2,
results_sample$coef_Q_sum_s3)
boxplot_beta0_estimate = cbind(rep(6,times=nsim),
rep(Censor_sample[i],times=nsim),
rep(nA,times=nsim),
results_sample$coef_estimate_s1,
results_sample$coef_estimate_s2,
results_sample$coef_estimate_s3)
boxplot_beta0 = rbind(boxplot_beta0,boxplot_beta0_true,boxplot_beta0_naive,
boxplot_beta0_w_sum1,  boxplot_beta0_w_sum2,
boxplot_beta0_Q_sum,boxplot_beta0_estimate  )
}
#titlename =paste ("K=", K)
colnames(boxplot_beta0) = c("Estimator", varies,fixed, "beta0.1","beta0.2","beta0.3")
boxplot_beta0 = data.frame(boxplot_beta0)
boxplot_beta0[,1] = factor(boxplot_beta0[,1],
levels = 1:6, labels = c("Theorical"," Naive", "weighted average", "2-max weighted average", "Q_weighted average","EM"))
boxplot_beta0[,2] = as.factor(boxplot_beta0[,2] )
boxplot_beta0[,3] = as.factor(boxplot_beta0[,3] )
boxplot_beta0[,4] = as.numeric(boxplot_beta0[,4] )
boxplot_beta0[,5] = as.numeric(boxplot_beta0[,5] )
boxplot_beta0[,6] = as.numeric(boxplot_beta0[,6] )
# Boxplots for beta0
beta0_1_censor = ggplot(boxplot_beta0,aes(x=censor,y= beta0.1,fill=Estimator))+
geom_boxplot()+
xlab(quote(nu))+
ylab(quote(hat(beta)[1]))+
geom_hline(yintercept=beta[1],lty=1,col="orange")
#+ggtitle(titlename)
#beta0_1
beta0_2_censor = ggplot(boxplot_beta0,aes(x=censor,y= beta0.2,fill=Estimator))+
geom_boxplot()+
theme(legend.position = "none")+
xlab(quote(nu))+
ylab(quote(hat(beta)[2]))+
geom_hline(yintercept=beta[2],lty=1,col="orange")
#+  ggtitle(titlename)
#beta0_2
beta0_3_censor = ggplot(boxplot_beta0,aes(x=censor,y= beta0.3,fill=Estimator))+
geom_boxplot()+
theme(legend.position = "none")+
xlab(quote(nu))+
ylab(quote(hat(beta)[3]))+
geom_hline(yintercept=beta[3],lty=1,col="orange")
#+  ggtitle(titlename)
#beta0_3
#figure <- ggarrange(beta0_1, beta0_2, beta0_3,
#                   common.legend = TRUE,
#                  ncol = 2, nrow = 2)
#figure
#########################################################
################### nA varied
setwd("C:/Users/fchezeut/Documents/GitHub/Cox-matched-data/3code_Q_inconnu")
#source("5_EM_scenarios.R")
source("7_EM_scenarios.R")
#scenarios_boxplot=scenarios[scenarios$K==9,]
scenarios_boxplot=scenarios[(scenarios$censor==2.948469 & scenarios$K==16)&
(scenarios$nB==2*scenarios$nA),]
#scenarios_boxplot=scenarios[scenarios$K==27,]
varies = "nA"
fixed="K"
library(ggplot2)
library(gridExtra)
library(xtable)
#Censor_sample=c(30,40,20)# for 30%,40%,20%
boxplot_beta0 = NULL
# size fix
for (i in (1:nrow(scenarios_boxplot))){
nsim = scenarios_boxplot[i,1]
K = scenarios_boxplot[i,2]
nA = scenarios_boxplot[i,3]
nB= scenarios_boxplot[i,4]
censor=scenarios_boxplot[i,5]
load(paste0("C:/Users/fchezeut/Documents/GitHub/Cox-matched-data/3code_Q_inconnu/Results/",
"nsim=",nsim,"_nA=",nA,"_K=",K,"censor=",censor,".Rdata"))
results_sample = results_sample
boxplot_beta0_true = cbind(rep(1,times=nsim),
rep(K,times=nsim),
rep(nA, times=nsim),
results_sample$coef_true_s1,
results_sample$coef_true_s2,
results_sample$coef_true_s3)
boxplot_beta0_naive = cbind(rep(2,times=nsim),
rep(K,times=nsim),
rep(nA, times=nsim),
results_sample$coef_naive_s1,
results_sample$coef_naive_s2,
results_sample$coef_naive_s3)
boxplot_beta0_w_sum1 = cbind(rep(3,times=nsim),
rep(K,times=nsim),
rep(nA,times=nsim),
results_sample$coef_w_sum1_s1,
results_sample$coef_w_sum1_s2,
results_sample$coef_w_sum1_s3)
boxplot_beta0_w_sum2 = cbind(rep(4,times=nsim),
rep(K,times=nsim),
rep(nA,times=nsim),
results_sample$coef_w_sum2_s1,
results_sample$coef_w_sum2_s2,
results_sample$coef_w_sum2_s3)
boxplot_beta0_Q_sum = cbind(rep(5,times=nsim),
rep(K,times=nsim),
rep(nA,times=nsim),
results_sample$coef_Q_sum_s1,
results_sample$coef_Q_sum_s2,
results_sample$coef_Q_sum_s3)
boxplot_beta0_estimate = cbind(rep(6,times=nsim),
rep(K,times=nsim),
rep(nA,times=nsim),
results_sample$coef_estimate_s1,
results_sample$coef_estimate_s2,
results_sample$coef_estimate_s3)
boxplot_beta0 = rbind(boxplot_beta0,boxplot_beta0_true,boxplot_beta0_naive,
boxplot_beta0_w_sum1,  boxplot_beta0_w_sum2,
boxplot_beta0_Q_sum,boxplot_beta0_estimate  )
}
#titlename =paste ("K=", K)
colnames(boxplot_beta0) = c("Estimator",fixed, varies, "beta0.1","beta0.2","beta0.3")
boxplot_beta0 = data.frame(boxplot_beta0)
boxplot_beta0[,1] = factor(boxplot_beta0[,1],
levels = 1:6, labels = c("Theorical"," Naive", "weighted average", "2-max weighted average","Q_weighted average", "EM"))
boxplot_beta0[,2] = as.factor(boxplot_beta0[,2] )
boxplot_beta0[,3] = as.factor(boxplot_beta0[,3] )
boxplot_beta0[,4] = as.numeric(boxplot_beta0[,4] )
boxplot_beta0[,5] = as.numeric(boxplot_beta0[,5] )
boxplot_beta0[,6] = as.numeric(boxplot_beta0[,6] )
# Boxplots for beta0
beta0_1_nA = ggplot(boxplot_beta0,aes(x=nA,y= beta0.1,fill=Estimator))+
geom_boxplot()+
xlab(quote(n[A]))+
ylab(quote(hat(beta)[1]))+
geom_hline(yintercept=beta[1],lty=1,col="orange")
#+  ggtitle(titlename)
#beta0_1
beta0_2_nA = ggplot(boxplot_beta0,aes(x=nA,y= beta0.2,fill=Estimator))+
geom_boxplot()+
theme(legend.position = "none")+
xlab(quote(n[A]))+
ylab(quote(hat(beta)[2]))+
geom_hline(yintercept=beta[2],lty=1,col="orange")
#+  ggtitle(titlename)
#beta0_2
beta0_3_nA = ggplot(boxplot_beta0,aes(x=nA,y= beta0.3,fill=Estimator))+
geom_boxplot()+
theme(legend.position = "none")+
xlab(quote(n[A]))+
ylab(quote(hat(beta)[3]))+
geom_hline(yintercept=beta[3],lty=1,col="orange")
#+  ggtitle(titlename)
#beta0_3
#beta0_3
#figure <- ggarrange(beta0_1, beta0_2, beta0_3,
#                   common.legend = TRUE,
#                  ncol = 2, nrow = 2)
#figure
#########
#########################################################
################### R varied
setwd("C:/Users/fchezeut/Documents/GitHub/Cox-matched-data/3code_Q_inconnu")
#source("5_EM_scenarios.R")
source("7_EM_scenarios.R")
#scenarios_boxplot=scenarios[scenarios$K==9,]
scenarios_boxplot=scenarios[(scenarios$K==16 & scenarios$censor!=1.553309)&
(scenarios$nA==1000& scenarios$censor!=6.392605), ]
#scenarios_boxplot=scenarios[scenarios$K==27,]
varies = "R"
fixed="K"
library(ggplot2)
library(gridExtra)
library(xtable)
#R=c(2,4,6) rapport de taille
boxplot_beta0 = NULL
# size fix
for (i in (1:nrow(scenarios_boxplot))){
nsim = scenarios_boxplot[i,1]
K = scenarios_boxplot[i,2]
nA = scenarios_boxplot[i,3]
nB= scenarios_boxplot[i,4]
censor=scenarios_boxplot[i,5]
R=nB/nA
load(paste0("C:/Users/fchezeut/Documents/GitHub/Cox-matched-data/3code_Q_inconnu/Results/",
"nsim=",nsim,"_nA=",nA,"_K=",K,"censor=",censor,".Rdata"))
results_sample = results_sample
boxplot_beta0_true = cbind(rep(1,times=nsim),
rep(R,times=nsim),
rep(nA, times=nsim),
results_sample$coef_true_s1,
results_sample$coef_true_s2,
results_sample$coef_true_s3)
boxplot_beta0_naive = cbind(rep(2,times=nsim),
rep(R,times=nsim),
rep(nA, times=nsim),
results_sample$coef_naive_s1,
results_sample$coef_naive_s2,
results_sample$coef_naive_s3)
boxplot_beta0_w_sum1 = cbind(rep(3,times=nsim),
rep(R,times=nsim),
rep(nA,times=nsim),
results_sample$coef_w_sum1_s1,
results_sample$coef_w_sum1_s2,
results_sample$coef_w_sum1_s3)
boxplot_beta0_w_sum2 = cbind(rep(4,times=nsim),
rep(R,times=nsim),
rep(nA,times=nsim),
results_sample$coef_w_sum2_s1,
results_sample$coef_w_sum2_s2,
results_sample$coef_w_sum2_s3)
boxplot_beta0_Q_sum = cbind(rep(5,times=nsim),
rep(R,times=nsim),
rep(nA,times=nsim),
results_sample$coef_Q_sum_s1,
results_sample$coef_Q_sum_s2,
results_sample$coef_Q_sum_s3)
boxplot_beta0_estimate = cbind(rep(6,times=nsim),
rep(R,times=nsim),
rep(nA,times=nsim),
results_sample$coef_estimate_s1,
results_sample$coef_estimate_s2,
results_sample$coef_estimate_s3)
boxplot_beta0 = rbind(boxplot_beta0,boxplot_beta0_true,boxplot_beta0_naive,
boxplot_beta0_w_sum1,  boxplot_beta0_w_sum2,
boxplot_beta0_Q_sum,boxplot_beta0_estimate  )
}
#titlename =paste ("nA=", nA)
colnames(boxplot_beta0) = c("Estimator", varies,fixed, "beta0.1","beta0.2","beta0.3")
boxplot_beta0 = data.frame(boxplot_beta0)
boxplot_beta0[,1] = factor(boxplot_beta0[,1],
levels = 1:6, labels = c("Theorical"," Naive", "weighted average", "2-max weighted average","Q_weighted average", "EM"))
boxplot_beta0[,2] = as.factor(boxplot_beta0[,2] )
boxplot_beta0[,3] = as.factor(boxplot_beta0[,3] )
boxplot_beta0[,4] = as.numeric(boxplot_beta0[,4] )
boxplot_beta0[,5] = as.numeric(boxplot_beta0[,5] )
boxplot_beta0[,6] = as.numeric(boxplot_beta0[,6] )
# Boxplots for beta0
beta0_1_R = ggplot(boxplot_beta0,aes(x=R,y= beta0.1,fill=Estimator))+
geom_boxplot()+
xlab(varies)+
ylab(quote(hat(beta)[1]))+
geom_hline(yintercept=beta[1],lty=1,col="orange")
#+  ggtitle(titlename)
#beta0_1
beta0_2_R = ggplot(boxplot_beta0,aes(x=R,y= beta0.2,fill=Estimator))+
geom_boxplot()+
theme(legend.position = "none")+
xlab(varies)+
ylab(quote(hat(beta)[2]))+
geom_hline(yintercept=beta[2],lty=1,col="orange")
#+  ggtitle(titlename)
#beta0_2
beta0_3_R = ggplot(boxplot_beta0,aes(x=R,y= beta0.3,fill=Estimator))+
geom_boxplot()+
theme(legend.position = "none")+
xlab(varies)+
ylab(quote(hat(beta)[3]))+
geom_hline(yintercept=beta[3],lty=1,col="orange")
#+  ggtitle(titlename)
#beta0_3
figure <- ggarrange(beta0_1_K, beta0_2_K, beta0_3_K,
beta0_1_nA, beta0_2_nA, beta0_3_nA,
beta0_1_censor, beta0_2_censor, beta0_3_censor,
beta0_1_R, beta0_2_R, beta0_3_R,
common.legend = TRUE,
ncol = 3, nrow = 4)
figure
figure
############### SCENARIOS
nA_sample = c(100,500,1000) # make sure we have nA >= 100
nB_sample = 2*nA_sample
p = 3
nsim =50
beta = c(0.5,-0.5,1)
R=c(4,6)
#(1.610541 3.039472 6.341335) for nA=100 (no difference with nA=1000)
censor_sample=c(1.553309,2.948469,6.392605)# for 40%,30%,20%
K_min= 22
#K_min= round(log(nB_sample)/log(2)) # min value of K for which we have a unique identification
#K_sample=  t(matrix(rep(c(9,18,27), p), ncol=3))# MULTIPLE OF 3, vary K
K_sample = cbind((K_min-10),(K_min-6),(K_min) )# make sure we have (K_min-5) >= 2
#prevalence_sample = c(0.05,0.1,0.2,0.3,0.4,0.5,0.6,0.7,0.8)
prevalence_sample = 0.5
############## Table of scenarios
scenarios = NULL
for (k in 1:length(K_sample)) {
KJ =  K_sample[k]
for (i in 1:length(nA_sample)){
nA = nA_sample[i]
nB= nB_sample[i]
censor= censor_sample[2]
scenarios = rbind(scenarios,c(nsim,KJ,nA,nB,censor))
}
}
addition = rbind( c(nsim, K_sample[2] ,nA_sample[3], nB_sample[3],censor_sample[1]),
c(nsim,K_sample[2] ,nA_sample[3], nB_sample[3],censor_sample[3]),
c(nsim,K_sample[2] ,nA_sample[3], R[1]*nA_sample[3],censor_sample[2]),
c(nsim,K_sample[2] ,nA_sample[3], R[2]*nA_sample[3],censor_sample[2]))
scenarios=rbind(scenarios,addition)
colnames(scenarios) = c("nsim","K","nA","nB","censor")
scenarios=data.frame(scenarios)
##################### matrix
scenarios
library(survival)
library(rootSolve)
library(nleqslv)
setwd("C:/Users/fchezeut/Documents/GitHub/Cox-matched-data/3code_Q_inconnu")
source("2_0_data_generate.R")
source("2_0_matrice_Q.R")
source("2_EM_risk_function.R")
source("3_naive_method.R")
source("4_method_w_sum1.R")
source("5_method_w_sum2.R")
source("6_EM_method_EM.R")
source("6_1_method_q_sum.R")
source("7_EM_scenarios.R")
scenarios
i=6
library(survival)
library(rootSolve)
library(nleqslv)
setwd("C:/Users/fchezeut/Documents/GitHub/Cox-matched-data/3code_Q_inconnu")
source("2_0_data_generate.R")
source("2_0_matrice_Q.R")
source("2_EM_risk_function.R")
source("3_naive_method.R")
source("4_method_w_sum1.R")
source("5_method_w_sum2.R")
source("6_EM_method_EM.R")
source("6_1_method_q_sum.R")
source("7_EM_scenarios.R")
################### nsim monte carlos
estimates_survival<- function(nsim,nA,nB,p,beta,K,prevalence,censor){
coef_true_s = matrix(0,nrow = nsim, ncol = p)
coef_naive_s = matrix(0,nrow = nsim, ncol = p)
converge_naive = vector()
coef_w_sum1_s = matrix(0,nrow = nsim, ncol = p)
converge_w_sum1 = vector()
coef_w_sum2_s = matrix(0,nrow = nsim, ncol = p)
converge_w_sum2 = vector()
coef_estimate_s = matrix(0,nrow = nsim, ncol = p)
converge_estimate = vector()
coef_Q_sum_s = matrix(0,nrow = nsim, ncol = p)
converge_Q_sum = vector()
for (i in 1:nsim){
#data generation
mf = Generate_data(K,nA,nB,prevalence,censor,min_prev = 0.01)
surv_data = mf$surv_data
XB = mf$XB
data_true=surv_data
idBA=mf$idBA
databaseA=mf$databaseA
databaseB =mf$ databaseB
datA=mf$datA # matching variables
datB= mf$datB
#####
#record linkage
comp_mat = compare_binary (datA, datB, K)
linked = Matrix_Q(comp_mat,K,datA, datB)
Q=linked$Q
# apply(Q,1,sum)
number=linked$number
naive_id = linked$naive_id
dif=linked$dif
#####naive
naive_data = generate_naive_data(naive_id,XB , surv_data)
Z = as.matrix(naive_data[,-c(1,2)])
Ts = data_true$Time
event = data_true$delta
lambda0 =  rep(0.1,length(event))
lambda0 [which(event == 0)] = 0
beta0 = rep(0.1,p)
# times of event
# death_times= Ts[which(event==1)]
# Theoretical estimating equation for true and naive data
fit_true = coxph(Surv(Time,delta)~.,data = data_true)
coef_true_s[i,] = as.vector(fit_true$coefficients)
# naive method
fit_naive = coxph_equa_naive(Ts,event, Z, maxiter = 20)
coef_naive_s[i,] = fit_naive$coef
converge_naive[i] = fit_naive$converge
# method with weighted average
fit_w_sum1 = coxph_w_sum1(Ts,event,XB, Q,maxiter = 20)
coef_w_sum1_s[i,] = fit_w_sum1$coef
converge_w_sum1[i] = fit_w_sum1$converge
#method with the maximum of proba
fit_w_sum2 = coxph_w_sum2(Ts,event,XB, Q, maxiter = 20)
coef_w_sum2_s[i,] = fit_w_sum2$coef
converge_w_sum2[i] = fit_w_sum2$converge
# method with Q average
fit_Q_sum = coxph_Q_sum(Ts,event,XB, Q,maxiter = 20)
coef_Q_sum_s[i,] = fit_Q_sum$coef
converge_Q_sum[i] = fit_Q_sum$converge
# EM method
fit_estimate = Func_itteration(beta0,lambda0,Ts,event,XB,Q,tol= 1e-6,maxits = 300)
coef_estimate_s[i,] = fit_estimate$beta0
it_EM = fit_estimate$it
}
return(list( coef_true_s1 = coef_true_s[,1], coef_true_s2 = coef_true_s[,2],coef_true_s3 = coef_true_s[,3],
coef_naive_s1 = coef_naive_s[,1], coef_naive_s2 = coef_naive_s[,2], coef_naive_s3 = coef_naive_s[,3],
coef_w_sum1_s1 = coef_w_sum1_s[,1],coef_w_sum1_s2 = coef_w_sum1_s[,2],coef_w_sum1_s3 = coef_w_sum1_s[,3],
coef_w_sum2_s1 = coef_w_sum2_s[,1], coef_w_sum2_s2 = coef_w_sum2_s[,2],coef_w_sum2_s3 = coef_w_sum2_s[,3],
coef_Q_sum_s1 = coef_Q_sum_s[,1],coef_Q_sum_s2 = coef_Q_sum_s[,2], coef_Q_sum_s3= coef_Q_sum_s[,3],
coef_estimate_s1 = coef_estimate_s[,1], coef_estimate_s2 = coef_estimate_s[,2],  coef_estimate_s3 = coef_estimate_s[,3],
converge_naive = converge_naive,  converge_w_sum1= converge_w_sum1,
converge_w_sum2 = converge_w_sum2, converge_Q_sum= converge_Q_sum,converge_estimate = converge_estimate )) }
######################################
nsim=scenarios[i,1]
K=scenarios[i,2]
nA=scenarios[i,3]
nB= scenarios[i,4]
censor= scenarios[i,5]
prevalence = rep(prevalence_sample,K)
results_sample = estimates_survival(nsim,nA,nB,p,beta,K,prevalence,censor) #monte carlos
filename = paste0("C:/Users/fchezeut/Documents/GitHub/Cox-matched-data/3code_Q_inconnu/Results/","nsim=",nsim,
"_nA=",nA,"_nB=",nB, "_K=",K,"censor=",censor,".Rdata")
save(results_sample,file = filename)
